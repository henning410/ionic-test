import {Component, ComponentFactoryResolver, Injector, Input, OnChanges, OnInit} from '@angular/core';
import {CommonModule} from '@angular/common';
import {FormsModule} from '@angular/forms';
import {IonicModule} from '@ionic/angular';
import * as L from 'leaflet';
import {Router, RouterModule} from "@angular/router";
import {GeoLocation} from "../models/location.model";
import {UserDataService} from "../services/user-data.service";
import {FeatureCollection} from 'geojson'
import {HttpClientModule} from "@angular/common/http";
import {PopupComponent} from "../popup/popup.component";

@Component({
  selector: 'app-osm-map2',
  templateUrl: './osm-map2.page.html',
  styleUrls: ['./osm-map2.page.scss'],
  standalone: true,
  imports: [IonicModule, CommonModule, FormsModule, RouterModule, HttpClientModule, PopupComponent]
})
export class OsmMap2Page implements OnInit, OnChanges {
  @Input() selectedLocation: any;
  @Input() evcs: any = [];

  currentUserLocation: GeoLocation = {latitude: 48.80308352215288, longitude: 9.198073272217787}
  map: any

  evcsIcon = L.icon({
    iconUrl: 'https://cdn-icons-png.flaticon.com/512/2017/2017809.png',
    iconSize: [40, 40], // size of the icon
  });

  homeIcon = L.icon({
    iconUrl: 'https://cdn-icons-png.flaticon.com/512/1243/1243945.png?w=740&t=st=1681553821~exp=1681554421~hmac=ecdbb2589b146e8cfe2abdd1b348b363f67029668d08f7aeb7cb8d996d5738b4',
    iconSize: [40, 40], // size of the icon
  });

  component = this.resolver.resolveComponentFactory(PopupComponent).create(this.injector);

  json: FeatureCollection = {
    "type": "FeatureCollection",
    "features": [{
      "bbox": [8.436021, 48.692806, 9.275281, 49.420538],
      "type": "Feature",
      "properties": {
        "segments": [{
          "distance": 138952.5,
          "duration": 5526.6,
          "steps": [{
            "distance": 1.9,
            "duration": 0.5,
            "type": 11,
            "instruction": "Head west on Gerhart-Hauptmann-Straße",
            "name": "Gerhart-Hauptmann-Straße",
            "way_points": [0, 1]
          }, {
            "distance": 100.3,
            "duration": 24.1,
            "type": 0,
            "instruction": "Turn left onto Wielandtstraße",
            "name": "Wielandtstraße",
            "way_points": [1, 4]
          }, {
            "distance": 42.4,
            "duration": 10.2,
            "type": 6,
            "instruction": "Continue straight onto Wielandtstraße",
            "name": "Wielandtstraße",
            "way_points": [4, 6]
          }, {
            "distance": 188.6,
            "duration": 47.6,
            "type": 5,
            "instruction": "Turn slight right onto Jahnstraße",
            "name": "Jahnstraße",
            "way_points": [6, 15]
          }, {
            "distance": 142.6,
            "duration": 37,
            "type": 5,
            "instruction": "Turn slight right onto Jahnstraße",
            "name": "Jahnstraße",
            "way_points": [15, 26]
          }, {
            "distance": 396.2,
            "duration": 48.6,
            "type": 0,
            "instruction": "Turn left onto Berliner Straße",
            "name": "Berliner Straße",
            "way_points": [26, 32]
          }, {
            "distance": 103.3,
            "duration": 25,
            "type": 13,
            "instruction": "Keep right onto Vangerowstraße",
            "name": "Vangerowstraße",
            "way_points": [32, 42]
          }, {
            "distance": 58.3,
            "duration": 10.5,
            "type": 12,
            "instruction": "Keep left onto Vangerowstraße",
            "name": "Vangerowstraße",
            "way_points": [42, 46]
          }, {
            "distance": 361.1,
            "duration": 58.5,
            "type": 0,
            "instruction": "Turn left onto Vangerowstraße, B 37",
            "name": "Vangerowstraße, B 37",
            "way_points": [46, 60]
          }, {
            "distance": 138.8,
            "duration": 36.8,
            "type": 12,
            "instruction": "Keep left onto B 37",
            "name": "B 37",
            "way_points": [60, 73]
          }, {
            "distance": 1691.2,
            "duration": 131.1,
            "type": 12,
            "instruction": "Keep left onto B 37",
            "name": "B 37",
            "way_points": [73, 87]
          }, {
            "distance": 541.4,
            "duration": 37.8,
            "type": 6,
            "instruction": "Continue straight onto B 37",
            "name": "B 37",
            "way_points": [87, 92]
          }, {
            "distance": 172.4,
            "duration": 6.9,
            "type": 13,
            "instruction": "Keep right",
            "name": "-",
            "way_points": [92, 96]
          }, {
            "distance": 516.4,
            "duration": 20.7,
            "type": 12,
            "instruction": "Keep left",
            "name": "-",
            "way_points": [96, 100]
          }, {
            "distance": 515,
            "duration": 57,
            "type": 13,
            "instruction": "Keep right onto A 5",
            "name": "A 5",
            "way_points": [100, 119]
          }, {
            "distance": 4770.6,
            "duration": 189.9,
            "type": 12,
            "instruction": "Keep left onto A 5",
            "name": "A 5",
            "way_points": [119, 162]
          }, {
            "distance": 8106,
            "duration": 234,
            "type": 6,
            "instruction": "Continue straight onto A 5",
            "name": "A 5",
            "way_points": [162, 217]
          }, {
            "distance": 1874.1,
            "duration": 50,
            "type": 6,
            "instruction": "Continue straight onto A 5",
            "name": "A 5",
            "way_points": [217, 229]
          }, {
            "distance": 246.4,
            "duration": 6.6,
            "type": 13,
            "instruction": "Keep right",
            "name": "-",
            "way_points": [229, 233]
          }, {
            "distance": 484.8,
            "duration": 12.9,
            "type": 12,
            "instruction": "Keep left",
            "name": "-",
            "way_points": [233, 239]
          }, {
            "distance": 5936.2,
            "duration": 158.3,
            "type": 12,
            "instruction": "Keep left onto A 5",
            "name": "A 5",
            "way_points": [239, 283]
          }, {
            "distance": 9278.8,
            "duration": 247.4,
            "type": 6,
            "instruction": "Continue straight onto A 5",
            "name": "A 5",
            "way_points": [283, 338]
          }, {
            "distance": 16426.5,
            "duration": 438,
            "type": 6,
            "instruction": "Continue straight onto A 5",
            "name": "A 5",
            "way_points": [338, 439]
          }, {
            "distance": 1910.3,
            "duration": 53.5,
            "type": 6,
            "instruction": "Continue straight onto A 5",
            "name": "A 5",
            "way_points": [439, 454]
          }, {
            "distance": 1903.3,
            "duration": 62.3,
            "type": 6,
            "instruction": "Continue straight onto A 5",
            "name": "A 5",
            "way_points": [454, 473]
          }, {
            "distance": 1564.8,
            "duration": 51.2,
            "type": 6,
            "instruction": "Continue straight onto A 5",
            "name": "A 5",
            "way_points": [473, 496]
          }, {
            "distance": 5885.6,
            "duration": 205.2,
            "type": 13,
            "instruction": "Keep right onto A 8",
            "name": "A 8",
            "way_points": [496, 595]
          }, {
            "distance": 15502.2,
            "duration": 497.7,
            "type": 6,
            "instruction": "Continue straight onto A 8",
            "name": "A 8",
            "way_points": [595, 794]
          }, {
            "distance": 2604.2,
            "duration": 91,
            "type": 12,
            "instruction": "Keep left onto A 8",
            "name": "A 8",
            "way_points": [794, 810]
          }, {
            "distance": 3879.7,
            "duration": 321.9,
            "type": 6,
            "instruction": "Continue straight onto A 8",
            "name": "A 8",
            "way_points": [810, 856]
          }, {
            "distance": 32783.7,
            "duration": 1089.1,
            "type": 6,
            "instruction": "Continue straight onto A 8",
            "name": "A 8",
            "way_points": [856, 1126]
          }, {
            "distance": 214.2,
            "duration": 8.6,
            "type": 13,
            "instruction": "Keep right onto A 81",
            "name": "A 81",
            "way_points": [1126, 1131]
          }, {
            "distance": 508.5,
            "duration": 13.6,
            "type": 12,
            "instruction": "Keep left",
            "name": "-",
            "way_points": [1131, 1141]
          }, {
            "distance": 6225.5,
            "duration": 222.7,
            "type": 12,
            "instruction": "Keep left",
            "name": "-",
            "way_points": [1141, 1216]
          }, {
            "distance": 2275.8,
            "duration": 81.9,
            "type": 6,
            "instruction": "Continue straight onto A 8",
            "name": "A 8",
            "way_points": [1216, 1238]
          }, {
            "distance": 6799.5,
            "duration": 244.8,
            "type": 6,
            "instruction": "Continue straight onto A 8",
            "name": "A 8",
            "way_points": [1238, 1299]
          }, {
            "distance": 341.4,
            "duration": 33.6,
            "type": 13,
            "instruction": "Keep right onto 54a",
            "name": "54a",
            "way_points": [1299, 1315]
          }, {
            "distance": 1639,
            "duration": 217.4,
            "type": 0,
            "instruction": "Turn left onto L 1209",
            "name": "L 1209",
            "way_points": [1315, 1368]
          }, {
            "distance": 32,
            "duration": 7.7,
            "type": 1,
            "instruction": "Turn right",
            "name": "-",
            "way_points": [1368, 1372]
          }, {
            "distance": 51.6,
            "duration": 12.4,
            "type": 0,
            "instruction": "Turn left",
            "name": "-",
            "way_points": [1372, 1375]
          }, {
            "distance": 1485.4,
            "duration": 189.2,
            "type": 3,
            "instruction": "Turn sharp right onto Ruiter Straße, L 1192",
            "name": "Ruiter Straße, L 1192",
            "way_points": [1375, 1469]
          }, {
            "distance": 300.5,
            "duration": 57.9,
            "type": 0,
            "instruction": "Turn left onto Niemöllerstraße",
            "name": "Niemöllerstraße",
            "way_points": [1469, 1488]
          }, {
            "distance": 644.1,
            "duration": 71.1,
            "type": 5,
            "instruction": "Turn slight right onto Niemöllerstraße",
            "name": "Niemöllerstraße",
            "way_points": [1488, 1516]
          }, {
            "distance": 229.8,
            "duration": 49.4,
            "type": 7,
            "instruction": "Enter the roundabout and take the 2nd exit onto Gerhard-Koch-Straße",
            "name": "Gerhard-Koch-Straße",
            "exit_number": 2,
            "way_points": [1516, 1534]
          }, {
            "distance": 76,
            "duration": 54.7,
            "type": 0,
            "instruction": "Turn left onto Montluelweg",
            "name": "Montluelweg",
            "way_points": [1534, 1536]
          }, {
            "distance": 2,
            "duration": 0.5,
            "type": 0,
            "instruction": "Turn left",
            "name": "-",
            "way_points": [1536, 1537]
          }, {
            "distance": 0,
            "duration": 0,
            "type": 10,
            "instruction": "Arrive at your destination, on the right",
            "name": "-",
            "way_points": [1537, 1537]
          }]
        }], "summary": {"distance": 138952.5, "duration": 5526.6}, "way_points": [0, 1537]
      },
      "geometry": {
        "coordinates": [[8.681496, 49.414601], [8.68147, 49.414599], [8.68145, 49.414545], [8.681237, 49.414057], [8.681086, 49.413733], [8.680931, 49.41347], [8.680873, 49.413377], [8.680639, 49.413311], [8.680601, 49.4133], [8.679517, 49.412976], [8.679435, 49.412952], [8.679326, 49.412935], [8.678824, 49.412797], [8.678732, 49.412768], [8.678631, 49.412758], [8.678488, 49.412704], [8.67805, 49.412679], [8.677508, 49.412647], [8.677467, 49.412645], [8.6774, 49.412641], [8.677247, 49.412631], [8.676997, 49.412664], [8.676922, 49.412665], [8.676752, 49.412669], [8.676661, 49.412672], [8.676616, 49.412674], [8.676528, 49.412675], [8.676535, 49.412593], [8.67658, 49.412115], [8.676603, 49.411668], [8.676689, 49.409663], [8.676672, 49.409461], [8.676699, 49.409115], [8.676662, 49.409051], [8.676643, 49.409019], [8.676609, 49.408987], [8.676575, 49.408962], [8.676402, 49.408897], [8.676199, 49.408877], [8.675999, 49.408879], [8.675762, 49.408874], [8.67558, 49.408855], [8.67545, 49.408843], [8.67517, 49.408847], [8.675016, 49.408877], [8.674817, 49.408947], [8.674713, 49.409006], [8.674542, 49.408938], [8.674388, 49.408898], [8.674228, 49.408867], [8.673997, 49.40884], [8.673756, 49.408825], [8.673651, 49.408825], [8.672587, 49.408836], [8.672434, 49.40884], [8.671871, 49.408868], [8.671558, 49.408901], [8.670811, 49.409014], [8.670644, 49.40904], [8.670034, 49.409168], [8.66984, 49.409186], [8.669795, 49.409173], [8.669752, 49.409153], [8.669716, 49.409136], [8.669676, 49.409106], [8.669648, 49.409069], [8.669503, 49.40884], [8.66922, 49.408374], [8.669196, 49.408333], [8.669162, 49.408292], [8.669078, 49.408239], [8.669011, 49.40821], [8.668921, 49.408176], [8.668866, 49.408177], [8.667877, 49.408226], [8.666932, 49.408266], [8.666381, 49.408316], [8.665452, 49.408428], [8.664576, 49.408594], [8.663678, 49.408791], [8.662762, 49.409012], [8.658257, 49.410211], [8.652422, 49.411782], [8.652057, 49.411874], [8.64971, 49.41247], [8.649439, 49.412538], [8.649, 49.412656], [8.646922, 49.413204], [8.64529, 49.413636], [8.642702, 49.414328], [8.642225, 49.414455], [8.640844, 49.414878], [8.640068, 49.415151], [8.639875, 49.415278], [8.639757, 49.41533], [8.639014, 49.415661], [8.638141, 49.416059], [8.636801, 49.416674], [8.636048, 49.417057], [8.634088, 49.418167], [8.632631, 49.419004], [8.63253, 49.41911], [8.631937, 49.41954], [8.631762, 49.419728], [8.631637, 49.419984], [8.631645, 49.420132], [8.631723, 49.420273], [8.631785, 49.420336], [8.631948, 49.420441], [8.632151, 49.42051], [8.632376, 49.420538], [8.632604, 49.420522], [8.632815, 49.420464], [8.632909, 49.42042], [8.63306, 49.420308], [8.633155, 49.420172], [8.633202, 49.420005], [8.633262, 49.419619], [8.63324, 49.418761], [8.633243, 49.418232], [8.633245, 49.418062], [8.63318, 49.417293], [8.633154, 49.417135], [8.6331, 49.41671], [8.633091, 49.416436], [8.633125, 49.416052], [8.633259, 49.415493], [8.633404, 49.415069], [8.633612, 49.41461], [8.633907, 49.413893], [8.634108, 49.41338], [8.634361, 49.412738], [8.634444, 49.412458], [8.634616, 49.411833], [8.635116, 49.410524], [8.635222, 49.410254], [8.635351, 49.409925], [8.63547, 49.409627], [8.636278, 49.407596], [8.636509, 49.406862], [8.636629, 49.406417], [8.636729, 49.405986], [8.636886, 49.405109], [8.637196, 49.402914], [8.637296, 49.402082], [8.637351, 49.401701], [8.638735, 49.391082], [8.638764, 49.390766], [8.638779, 49.390494], [8.638798, 49.389878], [8.638759, 49.388975], [8.638693, 49.388326], [8.63862, 49.387844], [8.638367, 49.386722], [8.638119, 49.385924], [8.637913, 49.385368], [8.637611, 49.384669], [8.637223, 49.383901], [8.634005, 49.378263], [8.633746, 49.377774], [8.633518, 49.377302], [8.633272, 49.376726], [8.633091, 49.376249], [8.632846, 49.37549], [8.632632, 49.374653], [8.632499, 49.373858], [8.632408, 49.373035], [8.632362, 49.372228], [8.632294, 49.370975], [8.632026, 49.365889], [8.631997, 49.365323], [8.631935, 49.364238], [8.631906, 49.363642], [8.631856, 49.362712], [8.631728, 49.360257], [8.63158, 49.357438], [8.631576, 49.357359], [8.631575, 49.357333], [8.631571, 49.357262], [8.631471, 49.355347], [8.631402, 49.354408], [8.631362, 49.353416], [8.631352, 49.353233], [8.631228, 49.35091], [8.631186, 49.350104], [8.631109, 49.348652], [8.631025, 49.347161], [8.631003, 49.346647], [8.63094, 49.345523], [8.630924, 49.345257], [8.630919, 49.345151], [8.630918, 49.345126], [8.630115, 49.329989], [8.630078, 49.329281], [8.630067, 49.329049], [8.62999, 49.327604], [8.629896, 49.325855], [8.629893, 49.325794], [8.629826, 49.32453], [8.629757, 49.323219], [8.6297, 49.322199], [8.629663, 49.321533], [8.629585, 49.32016], [8.629567, 49.319779], [8.629525, 49.318866], [8.629468, 49.317786], [8.629422, 49.316908], [8.62929, 49.314474], [8.629169, 49.313243], [8.628889, 49.311417], [8.628603, 49.30998], [8.628273, 49.308614], [8.628251, 49.308524], [8.627905, 49.307082], [8.627741, 49.306393], [8.627481, 49.305316], [8.627121, 49.303803], [8.627054, 49.303522], [8.626817, 49.302461], [8.626606, 49.301632], [8.626426, 49.300858], [8.626239, 49.300076], [8.626191, 49.299866], [8.626148, 49.299678], [8.624267, 49.291728], [8.623721, 49.289545], [8.623582, 49.288987], [8.623497, 49.288671], [8.62323, 49.287763], [8.622961, 49.286882], [8.622843, 49.286748], [8.622589, 49.286106], [8.622224, 49.28529], [8.621972, 49.284767], [8.621939, 49.284677], [8.621113, 49.282723], [8.620752, 49.281957], [8.620489, 49.281412], [8.620148, 49.280744], [8.620063, 49.28059], [8.619851, 49.280189], [8.619121, 49.278891], [8.618212, 49.277342], [8.618077, 49.277107], [8.617905, 49.276788], [8.617453, 49.276], [8.617429, 49.27588], [8.616551, 49.274646], [8.615465, 49.273231], [8.614228, 49.27171], [8.613231, 49.27052], [8.610394, 49.267069], [8.61023, 49.26688], [8.609205, 49.265635], [8.609092, 49.2655], [8.607253, 49.26328], [8.605457, 49.261104], [8.605241, 49.260849], [8.605032, 49.260597], [8.604062, 49.259428], [8.603242, 49.258422], [8.602562, 49.257511], [8.602191, 49.256943], [8.601591, 49.255895], [8.601248, 49.255177], [8.601135, 49.254918], [8.6008, 49.254073], [8.60054, 49.253149], [8.600466, 49.252825], [8.600342, 49.252261], [8.600233, 49.2515], [8.600164, 49.250738], [8.600152, 49.249667], [8.600185, 49.249127], [8.600508, 49.246553], [8.601328, 49.240501], [8.601674, 49.238192], [8.60174, 49.237591], [8.601826, 49.236836], [8.602464, 49.232033], [8.602497, 49.231796], [8.6026, 49.231038], [8.602651, 49.230639], [8.602706, 49.230215], [8.602844, 49.229182], [8.60296, 49.228301], [8.603173, 49.226766], [8.603227, 49.226323], [8.6036, 49.223535], [8.603745, 49.222443], [8.603803, 49.221806], [8.603817, 49.221344], [8.603767, 49.220024], [8.603619, 49.218904], [8.603528, 49.218452], [8.603332, 49.217703], [8.602961, 49.2166], [8.602572, 49.215724], [8.60226, 49.215112], [8.601892, 49.214469], [8.600481, 49.212293], [8.599871, 49.211341], [8.599402, 49.210624], [8.599216, 49.210335], [8.598677, 49.209501], [8.598449, 49.209148], [8.597676, 49.207961], [8.597605, 49.20785], [8.596132, 49.205583], [8.595967, 49.205339], [8.59591, 49.205251], [8.594319, 49.202785], [8.593155, 49.201062], [8.592933, 49.200737], [8.592801, 49.200544], [8.591991, 49.199354], [8.590479, 49.197144], [8.589988, 49.196434], [8.58928, 49.195384], [8.58753, 49.192822], [8.58049, 49.182491], [8.578923, 49.180029], [8.577739, 49.178016], [8.571889, 49.16735], [8.571342, 49.166356], [8.57095, 49.16563], [8.570541, 49.164894], [8.570275, 49.16441], [8.569304, 49.162686], [8.567531, 49.159806], [8.567298, 49.159449], [8.566959, 49.158928], [8.565924, 49.157332], [8.565835, 49.157193], [8.563798, 49.154052], [8.563363, 49.153378], [8.563264, 49.153224], [8.562677, 49.152318], [8.562527, 49.152083], [8.561673, 49.150771], [8.561647, 49.150731], [8.559559, 49.147494], [8.558981, 49.146551], [8.558523, 49.145804], [8.55818, 49.145244], [8.557856, 49.144716], [8.55765, 49.144374], [8.557134, 49.143496], [8.556995, 49.143293], [8.55684, 49.143039], [8.556667, 49.142739], [8.556358, 49.14223], [8.55548, 49.140797], [8.555448, 49.140745], [8.555222, 49.140398], [8.554567, 49.139329], [8.554194, 49.138721], [8.554005, 49.138413], [8.553761, 49.138016], [8.553605, 49.137765], [8.553272, 49.137218], [8.553207, 49.137106], [8.552996, 49.136741], [8.552961, 49.136681], [8.552591, 49.136001], [8.552182, 49.135166], [8.55167, 49.133921], [8.551556, 49.133587], [8.551492, 49.133401], [8.551398, 49.13311], [8.55104, 49.131757], [8.550838, 49.130617], [8.55072, 49.129517], [8.550692, 49.12902], [8.550684, 49.128117], [8.55074, 49.127074], [8.551266, 49.122803], [8.551464, 49.121003], [8.551484, 49.119879], [8.551432, 49.119078], [8.551329, 49.118314], [8.551171, 49.117521], [8.551056, 49.117056], [8.550774, 49.116172], [8.550467, 49.115387], [8.550143, 49.114687], [8.549671, 49.113807], [8.549429, 49.113417], [8.549191, 49.113043], [8.548955, 49.112708], [8.548389, 49.111944], [8.547053, 49.110273], [8.544197, 49.10667], [8.542566, 49.104623], [8.541975, 49.103876], [8.540569, 49.102107], [8.53952, 49.10078], [8.538098, 49.098999], [8.532965, 49.092531], [8.532165, 49.091557], [8.531458, 49.090734], [8.53081, 49.090014], [8.529885, 49.089048], [8.528972, 49.088142], [8.527685, 49.086928], [8.526841, 49.086186], [8.525308, 49.084907], [8.51532, 49.077045], [8.515101, 49.076876], [8.514252, 49.076203], [8.512838, 49.075099], [8.512, 49.074383], [8.510969, 49.073384], [8.510447, 49.072815], [8.510227, 49.072558], [8.509925, 49.072186], [8.509649, 49.071842], [8.509076, 49.071053], [8.508881, 49.07078], [8.508459, 49.070183], [8.506767, 49.067825], [8.506249, 49.067098], [8.50572, 49.066362], [8.505131, 49.065537], [8.504284, 49.064345], [8.494815, 49.051093], [8.492135, 49.047376], [8.49008, 49.044328], [8.482599, 49.03308], [8.481539, 49.031521], [8.480388, 49.029958], [8.479438, 49.028777], [8.479192, 49.02848], [8.478915, 49.028156], [8.478178, 49.027327], [8.47654, 49.025598], [8.47245, 49.021677], [8.47176, 49.021019], [8.471541, 49.020807], [8.470455, 49.019767], [8.470236, 49.019559], [8.462915, 49.012565], [8.462501, 49.012174], [8.462039, 49.011721], [8.461741, 49.01144], [8.461008, 49.010728], [8.459851, 49.009681], [8.458845, 49.00884], [8.458698, 49.008712], [8.45816, 49.008266], [8.457081, 49.007439], [8.456798, 49.007224], [8.455573, 49.006344], [8.455324, 49.006168], [8.454989, 49.005928], [8.453448, 49.00491], [8.451995, 49.00398], [8.45054, 49.003047], [8.448278, 49.001602], [8.447549, 49.001132], [8.446017, 49.000149], [8.445764, 48.999985], [8.445258, 48.999662], [8.443286, 48.998401], [8.442103, 48.997647], [8.440579, 48.996679], [8.440162, 48.996406], [8.439766, 48.996154], [8.438903, 48.995503], [8.438531, 48.995189], [8.438184, 48.994861], [8.43761, 48.994243], [8.437233, 48.993736], [8.437112, 48.993557], [8.437018, 48.993419], [8.436716, 48.992884], [8.436434, 48.992292], [8.436328, 48.992013], [8.4362, 48.991588], [8.436091, 48.991116], [8.436062, 48.990882], [8.436039, 48.990618], [8.436021, 48.990195], [8.436032, 48.989639], [8.43611, 48.988812], [8.436165, 48.988013], [8.436237, 48.987215], [8.436303, 48.986395], [8.436351, 48.985803], [8.436356, 48.98573], [8.436375, 48.985479], [8.436432, 48.984834], [8.436579, 48.983058], [8.436664, 48.982043], [8.436723, 48.981336], [8.43676, 48.980834], [8.436848, 48.9796], [8.436757, 48.979336], [8.436774, 48.97902], [8.436782, 48.978573], [8.43677, 48.978138], [8.436748, 48.977871], [8.43672, 48.977537], [8.436636, 48.976758], [8.43662, 48.976583], [8.436603, 48.976262], [8.43662, 48.975802], [8.436715, 48.975345], [8.436777, 48.975146], [8.43686, 48.974926], [8.437147, 48.974383], [8.437296, 48.97417], [8.437412, 48.974021], [8.437637, 48.973764], [8.438067, 48.973365], [8.438368, 48.97313], [8.438789, 48.972849], [8.438881, 48.972793], [8.439024, 48.972711], [8.439339, 48.972544], [8.439541, 48.97245], [8.43982, 48.972325], [8.440607, 48.972048], [8.440994, 48.971943], [8.441264, 48.97188], [8.442054, 48.971739], [8.442739, 48.97167], [8.443094, 48.971651], [8.444102, 48.971648], [8.444618, 48.971659], [8.44516, 48.971671], [8.445535, 48.97168], [8.44638, 48.971699], [8.448535, 48.971743], [8.448937, 48.971732], [8.449391, 48.971771], [8.450328, 48.971729], [8.450612, 48.971717], [8.451642, 48.971671], [8.452198, 48.971646], [8.453007, 48.971612], [8.453754, 48.971574], [8.453958, 48.971561], [8.454698, 48.971506], [8.4554, 48.971427], [8.456045, 48.971317], [8.456565, 48.971218], [8.456891, 48.971139], [8.457407, 48.971002], [8.457986, 48.970814], [8.458329, 48.970684], [8.459012, 48.970382], [8.45971, 48.970012], [8.460798, 48.96935], [8.461608, 48.968836], [8.462125, 48.968518], [8.463826, 48.967466], [8.464526, 48.966995], [8.464818, 48.966763], [8.465354, 48.966262], [8.466018, 48.965618], [8.466155, 48.965491], [8.466606, 48.965071], [8.467283, 48.964531], [8.46778, 48.964178], [8.468254, 48.96388], [8.469384, 48.963242], [8.469495, 48.963181], [8.469732, 48.963046], [8.471251, 48.96219], [8.471885, 48.961863], [8.472253, 48.961697], [8.473169, 48.961312], [8.475462, 48.960361], [8.476494, 48.959865], [8.47692, 48.959642], [8.477117, 48.959533], [8.477441, 48.959346], [8.478251, 48.958845], [8.478877, 48.958409], [8.479494, 48.957933], [8.480053, 48.957468], [8.480676, 48.956888], [8.483889, 48.953745], [8.484147, 48.953485], [8.484977, 48.95266], [8.485885, 48.951788], [8.486215, 48.951469], [8.48654, 48.951143], [8.487301, 48.950421], [8.4886, 48.949308], [8.489245, 48.948819], [8.489915, 48.948341], [8.490397, 48.948023], [8.491082, 48.947602], [8.491771, 48.947185], [8.49235, 48.946861], [8.493076, 48.946497], [8.493846, 48.946117], [8.494665, 48.945746], [8.494995, 48.945606], [8.49589, 48.945246], [8.496673, 48.944957], [8.497744, 48.944585], [8.499838, 48.943892], [8.500292, 48.943747], [8.500782, 48.943586], [8.502282, 48.943097], [8.502819, 48.94292], [8.504106, 48.942499], [8.507217, 48.941484], [8.508903, 48.940932], [8.509983, 48.940576], [8.511061, 48.940226], [8.51228, 48.939828], [8.516942, 48.938325], [8.51752, 48.938153], [8.518554, 48.937885], [8.51923, 48.93773], [8.519582, 48.937658], [8.519967, 48.937579], [8.521074, 48.937389], [8.522092, 48.937254], [8.522609, 48.937198], [8.523973, 48.937091], [8.524789, 48.93706], [8.525686, 48.937047], [8.526361, 48.937055], [8.527222, 48.937077], [8.528502, 48.937149], [8.530749, 48.937336], [8.531298, 48.937392], [8.531848, 48.937442], [8.532345, 48.937487], [8.534364, 48.937655], [8.535498, 48.937699], [8.536457, 48.937696], [8.537095, 48.937663], [8.537758, 48.937608], [8.538884, 48.937456], [8.539572, 48.937327], [8.540309, 48.937155], [8.540717, 48.937045], [8.541393, 48.936834], [8.542406, 48.936458], [8.543153, 48.936145], [8.54374, 48.935894], [8.544934, 48.9354], [8.545995, 48.935008], [8.546573, 48.934813], [8.547613, 48.934492], [8.548748, 48.93419], [8.54968, 48.933991], [8.55024, 48.933892], [8.550963, 48.933787], [8.552221, 48.933676], [8.552744, 48.933651], [8.55349, 48.933639], [8.553994, 48.933643], [8.554391, 48.933656], [8.55524, 48.933713], [8.556289, 48.933828], [8.560294, 48.934423], [8.561531, 48.934593], [8.562383, 48.934677], [8.563162, 48.934724], [8.563978, 48.934747], [8.564685, 48.934747], [8.566144, 48.934679], [8.566774, 48.934621], [8.567649, 48.934513], [8.568411, 48.93439], [8.569213, 48.934234], [8.569845, 48.934088], [8.570082, 48.934029], [8.571129, 48.933734], [8.571545, 48.933596], [8.572318, 48.933318], [8.572741, 48.933149], [8.573635, 48.93275], [8.574583, 48.932259], [8.574913, 48.932068], [8.575257, 48.931864], [8.575527, 48.931698], [8.57685, 48.930855], [8.577431, 48.930521], [8.577957, 48.930261], [8.578476, 48.930039], [8.579211, 48.929767], [8.579899, 48.92956], [8.580674, 48.929378], [8.581551, 48.92922], [8.583546, 48.928926], [8.584336, 48.928754], [8.584769, 48.928631], [8.584994, 48.928562], [8.585615, 48.928335], [8.586309, 48.928023], [8.586822, 48.927738], [8.58737, 48.927403], [8.587698, 48.927188], [8.58824, 48.926826], [8.589008, 48.926336], [8.589437, 48.926105], [8.589892, 48.925887], [8.590434, 48.925666], [8.591004, 48.925471], [8.591636, 48.925297], [8.592006, 48.925211], [8.592503, 48.925116], [8.592999, 48.925043], [8.593945, 48.924959], [8.594519, 48.924942], [8.597044, 48.924938], [8.59767, 48.924907], [8.598191, 48.924861], [8.59891, 48.924753], [8.599341, 48.924668], [8.600025, 48.924502], [8.600646, 48.924306], [8.601078, 48.924137], [8.60152, 48.923942], [8.60209, 48.923654], [8.605053, 48.921887], [8.605772, 48.921476], [8.606461, 48.921128], [8.607114, 48.92083], [8.607753, 48.920564], [8.611647, 48.919066], [8.612388, 48.918727], [8.613091, 48.918327], [8.613353, 48.918155], [8.613476, 48.918069], [8.613672, 48.917927], [8.613944, 48.91771], [8.614278, 48.917419], [8.614668, 48.917039], [8.616723, 48.914896], [8.617112, 48.914523], [8.617372, 48.914294], [8.61798, 48.913818], [8.618302, 48.913598], [8.618754, 48.913315], [8.619133, 48.91311], [8.619795, 48.912785], [8.620594, 48.91245], [8.621172, 48.912243], [8.621381, 48.91217], [8.622214, 48.911895], [8.622975, 48.911637], [8.623981, 48.911304], [8.625605, 48.910773], [8.626495, 48.910499], [8.627305, 48.910283], [8.627838, 48.910156], [8.628508, 48.910007], [8.629241, 48.909866], [8.630841, 48.909623], [8.631336, 48.909564], [8.631995, 48.9095], [8.633135, 48.909423], [8.634839, 48.909383], [8.635581, 48.909383], [8.636341, 48.909413], [8.637799, 48.909475], [8.638899, 48.909495], [8.641606, 48.909487], [8.643732, 48.909401], [8.645615, 48.909242], [8.646068, 48.909198], [8.647279, 48.909053], [8.647567, 48.909019], [8.647924, 48.908974], [8.650022, 48.908714], [8.651915, 48.90849], [8.652852, 48.908384], [8.653517, 48.908314], [8.653777, 48.908287], [8.655239, 48.908146], [8.65699, 48.908001], [8.658231, 48.907922], [8.658843, 48.907893], [8.660924, 48.907777], [8.661593, 48.907749], [8.662778, 48.907714], [8.663305, 48.907702], [8.66398, 48.907699], [8.665594, 48.90769], [8.672285, 48.907815], [8.675125, 48.907905], [8.678577, 48.90807], [8.681108, 48.908224], [8.682887, 48.908356], [8.683713, 48.908436], [8.685582, 48.908614], [8.68999, 48.909106], [8.693967, 48.909691], [8.694635, 48.909813], [8.695135, 48.9099], [8.695591, 48.909984], [8.697584, 48.910391], [8.698976, 48.91075], [8.701199, 48.911382], [8.705169, 48.912583], [8.707624, 48.913334], [8.708451, 48.91359], [8.710555, 48.914241], [8.713132, 48.915012], [8.714484, 48.915409], [8.717367, 48.916189], [8.718888, 48.916612], [8.720282, 48.916955], [8.72103, 48.91714], [8.721643, 48.917268], [8.723671, 48.917744], [8.724485, 48.917915], [8.73022, 48.919084], [8.731532, 48.919385], [8.732477, 48.919635], [8.733394, 48.919897], [8.734646, 48.920324], [8.735615, 48.920676], [8.737096, 48.921258], [8.738967, 48.922107], [8.740145, 48.922652], [8.74065, 48.922886], [8.7414, 48.923223], [8.742205, 48.923543], [8.742941, 48.92379], [8.743568, 48.923957], [8.744318, 48.924121], [8.745121, 48.924257], [8.745902, 48.924349], [8.74655, 48.924397], [8.747557, 48.924421], [8.748555, 48.924382], [8.749052, 48.924341], [8.749518, 48.924289], [8.750159, 48.924192], [8.751456, 48.923913], [8.752023, 48.923749], [8.752806, 48.923484], [8.753695, 48.92311], [8.754552, 48.922648], [8.754982, 48.922394], [8.755342, 48.922156], [8.756163, 48.921495], [8.757751, 48.920155], [8.758391, 48.919648], [8.759011, 48.919141], [8.760156, 48.918139], [8.760725, 48.917658], [8.761292, 48.91718], [8.761909, 48.91666], [8.762812, 48.915912], [8.763091, 48.915677], [8.763378, 48.915446], [8.763675, 48.915201], [8.764119, 48.914836], [8.764533, 48.914487], [8.765116, 48.913968], [8.765281, 48.913829], [8.765651, 48.913517], [8.766738, 48.912648], [8.767291, 48.912192], [8.769421, 48.910349], [8.77062, 48.909342], [8.771701, 48.90843], [8.776745, 48.904193], [8.779612, 48.901621], [8.780256, 48.900978], [8.781115, 48.900038], [8.781673, 48.899346], [8.782612, 48.898253], [8.783178, 48.897514], [8.783687, 48.896803], [8.784171, 48.896055], [8.784668, 48.895201], [8.785173, 48.894211], [8.785471, 48.893488], [8.785907, 48.892322], [8.786066, 48.891821], [8.786633, 48.889927], [8.787072, 48.888164], [8.7873, 48.887045], [8.787379, 48.886578], [8.787568, 48.885389], [8.787759, 48.88396], [8.787836, 48.883162], [8.788035, 48.881345], [8.788136, 48.880413], [8.788203, 48.879676], [8.788293, 48.879002], [8.788313, 48.878725], [8.788351, 48.87842], [8.788422, 48.87777], [8.788565, 48.876879], [8.788865, 48.875097], [8.789113, 48.873897], [8.789756, 48.87143], [8.790598, 48.869065], [8.791855, 48.866088], [8.792406, 48.864901], [8.793545, 48.862587], [8.794152, 48.861452], [8.795119, 48.85973], [8.796137, 48.858011], [8.797207, 48.856317], [8.798088, 48.854996], [8.799134, 48.853564], [8.799681, 48.852906], [8.800265, 48.85225], [8.800705, 48.851768], [8.800829, 48.851636], [8.801258, 48.851206], [8.801857, 48.850665], [8.802478, 48.850146], [8.803057, 48.849689], [8.804169, 48.848889], [8.805482, 48.84807], [8.80627, 48.847616], [8.807102, 48.847175], [8.808064, 48.846715], [8.808987, 48.846305], [8.810413, 48.845729], [8.812308, 48.845042], [8.816832, 48.843527], [8.817455, 48.843312], [8.817888, 48.84317], [8.818759, 48.84288], [8.821472, 48.84197], [8.822866, 48.841524], [8.823785, 48.841255], [8.824882, 48.840962], [8.826117, 48.840692], [8.827061, 48.840518], [8.828547, 48.840333], [8.8293, 48.840264], [8.83034, 48.840201], [8.831188, 48.840158], [8.831541, 48.840145], [8.832175, 48.840129], [8.834338, 48.840081], [8.837168, 48.839996], [8.838579, 48.839919], [8.839829, 48.839823], [8.840993, 48.839702], [8.842512, 48.839493], [8.84435, 48.839156], [8.845574, 48.838877], [8.847043, 48.838492], [8.847998, 48.838195], [8.849565, 48.837658], [8.851213, 48.836985], [8.852403, 48.836435], [8.853425, 48.835936], [8.854425, 48.83541], [8.85933, 48.832764], [8.861063, 48.831858], [8.86187, 48.831468], [8.862689, 48.831103], [8.863531, 48.830743], [8.865073, 48.830172], [8.866118, 48.829834], [8.867079, 48.829546], [8.867473, 48.82943], [8.869105, 48.828975], [8.869353, 48.828905], [8.869979, 48.828731], [8.872358, 48.828097], [8.874744, 48.827396], [8.877562, 48.826556], [8.880939, 48.82555], [8.883855, 48.824732], [8.884337, 48.824608], [8.886269, 48.824111], [8.888222, 48.823639], [8.889315, 48.823384], [8.890596, 48.823094], [8.893056, 48.822572], [8.896226, 48.821886], [8.897258, 48.821655], [8.899198, 48.821185], [8.90142, 48.820594], [8.902958, 48.820136], [8.905385, 48.819305], [8.90625, 48.81898], [8.907485, 48.818506], [8.909811, 48.817534], [8.911404, 48.816776], [8.912142, 48.816382], [8.914108, 48.81531], [8.914681, 48.814998], [8.915791, 48.814371], [8.916727, 48.813841], [8.917574, 48.813352], [8.920276, 48.811814], [8.931071, 48.805644], [8.932388, 48.804884], [8.932829, 48.804631], [8.933983, 48.804027], [8.936173, 48.802894], [8.93725, 48.802381], [8.937785, 48.802146], [8.93832, 48.801916], [8.939722, 48.801371], [8.940934, 48.80094], [8.942187, 48.800533], [8.94385, 48.80005], [8.944513, 48.799875], [8.94561, 48.799608], [8.948213, 48.799042], [8.950691, 48.798498], [8.952623, 48.798017], [8.954147, 48.797582], [8.95534, 48.797193], [8.956509, 48.796792], [8.960256, 48.79539], [8.965208, 48.79356], [8.96663, 48.793037], [8.968939, 48.792177], [8.96917, 48.792089], [8.970768, 48.791526], [8.971296, 48.791334], [8.972667, 48.790838], [8.974356, 48.790224], [8.974955, 48.790012], [8.97719, 48.789223], [8.977669, 48.789057], [8.979606, 48.788388], [8.98167, 48.787689], [8.982635, 48.787375], [8.983687, 48.787053], [8.984777, 48.786757], [8.985489, 48.786602], [8.985985, 48.786494], [8.988575, 48.786001], [8.994655, 48.785043], [8.995695, 48.78488], [8.996656, 48.784734], [8.998504, 48.784446], [9.000691, 48.784108], [9.001055, 48.784051], [9.002607, 48.783805], [9.004861, 48.783417], [9.006757, 48.78304], [9.008545, 48.782598], [9.009349, 48.782374], [9.009941, 48.782204], [9.01104, 48.781839], [9.012105, 48.781446], [9.013475, 48.780861], [9.020069, 48.777747], [9.021765, 48.776924], [9.021983, 48.776834], [9.022739, 48.776445], [9.023507, 48.775999], [9.023908, 48.775743], [9.024271, 48.775517], [9.024428, 48.775415], [9.024977, 48.775024], [9.025481, 48.774634], [9.025929, 48.774266], [9.026272, 48.773907], [9.026353, 48.773829], [9.026489, 48.773689], [9.026673, 48.773487], [9.026865, 48.773294], [9.0272, 48.77295], [9.027434, 48.77268], [9.02772, 48.772336], [9.027833, 48.772193], [9.02846, 48.771316], [9.028926, 48.770569], [9.029428, 48.769657], [9.029895, 48.768723], [9.030095, 48.768308], [9.03015, 48.768194], [9.030297, 48.76788], [9.030893, 48.766563], [9.031687, 48.76481], [9.031796, 48.764565], [9.032131, 48.763771], [9.032401, 48.76301], [9.032631, 48.762068], [9.032759, 48.761261], [9.033067, 48.758509], [9.033103, 48.75816], [9.03314, 48.757808], [9.033246, 48.75686], [9.033412, 48.755384], [9.033577, 48.753932], [9.034263, 48.747605], [9.034409, 48.746433], [9.034451, 48.745941], [9.034477, 48.745725], [9.034602, 48.744911], [9.034643, 48.744589], [9.034652, 48.744538], [9.034877, 48.743409], [9.035159, 48.742471], [9.035351, 48.741974], [9.035699, 48.74123], [9.035947, 48.740772], [9.036251, 48.740273], [9.036355, 48.740109], [9.036692, 48.739635], [9.037253, 48.738929], [9.037562, 48.738579], [9.037839, 48.738282], [9.03803, 48.738081], [9.038845, 48.737333], [9.039462, 48.736826], [9.040113, 48.736341], [9.040806, 48.735876], [9.041046, 48.735725], [9.041164, 48.735652], [9.042112, 48.735097], [9.043458, 48.73439], [9.05136, 48.730621], [9.053413, 48.729681], [9.0546, 48.729187], [9.055886, 48.72871], [9.056752, 48.728431], [9.058315, 48.727985], [9.058455, 48.72795], [9.058848, 48.727849], [9.059148, 48.727692], [9.059413, 48.727625], [9.060337, 48.727412], [9.06126, 48.727229], [9.061557, 48.72717], [9.061722, 48.727164], [9.061895, 48.727148], [9.065523, 48.726554], [9.065673, 48.72653], [9.06599, 48.726476], [9.067051, 48.726283], [9.067355, 48.726219], [9.067605, 48.726158], [9.068067, 48.726037], [9.068242, 48.725989], [9.068428, 48.725937], [9.06862, 48.725877], [9.069415, 48.725621], [9.06981, 48.725488], [9.070077, 48.725448], [9.070392, 48.72531], [9.07066, 48.725191], [9.07084, 48.725103], [9.071428, 48.724814], [9.071904, 48.724541], [9.072304, 48.724301], [9.07311, 48.72379], [9.073954, 48.723266], [9.074226, 48.723097], [9.074618, 48.722844], [9.074686, 48.722801], [9.075323, 48.722399], [9.078031, 48.720698], [9.079525, 48.719761], [9.079832, 48.719569], [9.081869, 48.718286], [9.083392, 48.717338], [9.083797, 48.717084], [9.084037, 48.71694], [9.084453, 48.716695], [9.084687, 48.716562], [9.085828, 48.715975], [9.087092, 48.715409], [9.087562, 48.715224], [9.088019, 48.71505], [9.089163, 48.714669], [9.090353, 48.714328], [9.094118, 48.713396], [9.095354, 48.713089], [9.095421, 48.713073], [9.095808, 48.712977], [9.096262, 48.712865], [9.096638, 48.712773], [9.100143, 48.711918], [9.101731, 48.711573], [9.102516, 48.711421], [9.10331, 48.711263], [9.104214, 48.711087], [9.104707, 48.71099], [9.105827, 48.710773], [9.106061, 48.710727], [9.108021, 48.710345], [9.113852, 48.709206], [9.114556, 48.709067], [9.114978, 48.708988], [9.1154, 48.708908], [9.115897, 48.708825], [9.11705, 48.708653], [9.118964, 48.708447], [9.119851, 48.708381], [9.121297, 48.708313], [9.121971, 48.708305], [9.122208, 48.7083], [9.123016, 48.708303], [9.124616, 48.708356], [9.125922, 48.708446], [9.129127, 48.708791], [9.129875, 48.708878], [9.132164, 48.709134], [9.134032, 48.70934], [9.135842, 48.709492], [9.136787, 48.709535], [9.138487, 48.709561], [9.138763, 48.709564], [9.139165, 48.709564], [9.139723, 48.709545], [9.140294, 48.709516], [9.14199, 48.7094], [9.144135, 48.709141], [9.145056, 48.709012], [9.145562, 48.70894], [9.160237, 48.706886], [9.161474, 48.706714], [9.16318, 48.706477], [9.164568, 48.706284], [9.16557, 48.706146], [9.165715, 48.706126], [9.165824, 48.706112], [9.166442, 48.706026], [9.166639, 48.705996], [9.1671, 48.705919], [9.167613, 48.705833], [9.167935, 48.705772], [9.168529, 48.705655], [9.168899, 48.705574], [9.169536, 48.705429], [9.169916, 48.705338], [9.170888, 48.705088], [9.172161, 48.704713], [9.173381, 48.704304], [9.174121, 48.704029], [9.174868, 48.703734], [9.175497, 48.703467], [9.177039, 48.702762], [9.179413, 48.701636], [9.181124, 48.700811], [9.18147, 48.700651], [9.182521, 48.70015], [9.183829, 48.699528], [9.185628, 48.698669], [9.187397, 48.697828], [9.1884, 48.697345], [9.189374, 48.696897], [9.19136, 48.696031], [9.19224, 48.695675], [9.193233, 48.695311], [9.193961, 48.69506], [9.194791, 48.694804], [9.19514, 48.694697], [9.196045, 48.694442], [9.197535, 48.694066], [9.197783, 48.694011], [9.199013, 48.69375], [9.199673, 48.693625], [9.200452, 48.693491], [9.200924, 48.693415], [9.201866, 48.693277], [9.202508, 48.693199], [9.20377, 48.693067], [9.2045, 48.693005], [9.206537, 48.69288], [9.207526, 48.692843], [9.209227, 48.692811], [9.210281, 48.692806], [9.212456, 48.69283], [9.214579, 48.692899], [9.216749, 48.693017], [9.218491, 48.693142], [9.219839, 48.69326], [9.221818, 48.693469], [9.223226, 48.693642], [9.225647, 48.693983], [9.22782, 48.694338], [9.230074, 48.694741], [9.241962, 48.696979], [9.243073, 48.697162], [9.244504, 48.697353], [9.245557, 48.697461], [9.246571, 48.697538], [9.24726, 48.697576], [9.247958, 48.6976], [9.249479, 48.697619], [9.250784, 48.697586], [9.252278, 48.697498], [9.253114, 48.697425], [9.254881, 48.697211], [9.255679, 48.697088], [9.256276, 48.696986], [9.258158, 48.696615], [9.259001, 48.696442], [9.259369, 48.696366], [9.260772, 48.696081], [9.261724, 48.695909], [9.261856, 48.69581], [9.261994, 48.695759], [9.262201, 48.69565], [9.262365, 48.695535], [9.262489, 48.695401], [9.262585, 48.69516], [9.262647, 48.694833], [9.262755, 48.694622], [9.262908, 48.694484], [9.263005, 48.694429], [9.263119, 48.694376], [9.263335, 48.694308], [9.26356, 48.694263], [9.263772, 48.69422], [9.26466, 48.694101], [9.264862, 48.694073], [9.264882, 48.694138], [9.264895, 48.694187], [9.264917, 48.694262], [9.264931, 48.694308], [9.264963, 48.694426], [9.26501, 48.694623], [9.265053, 48.694805], [9.265136, 48.695184], [9.265147, 48.695257], [9.2652, 48.695695], [9.265217, 48.69606], [9.265225, 48.69622], [9.26521, 48.696763], [9.265205, 48.696986], [9.265135, 48.697698], [9.26491, 48.69937], [9.264735, 48.700609], [9.264662, 48.701236], [9.264622, 48.70185], [9.264627, 48.702156], [9.264669, 48.702543], [9.264689, 48.702653], [9.264738, 48.702868], [9.26486, 48.70326], [9.264983, 48.703554], [9.265422, 48.704457], [9.265496, 48.704651], [9.265564, 48.704927], [9.265578, 48.705086], [9.265573, 48.705375], [9.265545, 48.705536], [9.265486, 48.705745], [9.265378, 48.705996], [9.265298, 48.706132], [9.265036, 48.706516], [9.264958, 48.70662], [9.264907, 48.706686], [9.264847, 48.706749], [9.264824, 48.706767], [9.264764, 48.706798], [9.2647, 48.706829], [9.264418, 48.706954], [9.264119, 48.707092], [9.264088, 48.707108], [9.264055, 48.70713], [9.263934, 48.70723], [9.263797, 48.707385], [9.263723, 48.707557], [9.263705, 48.707564], [9.263689, 48.707565], [9.263272, 48.707423], [9.262917, 48.707268], [9.26278, 48.707211], [9.262712, 48.707278], [9.262713, 48.707316], [9.262751, 48.707349], [9.262849, 48.707459], [9.26265, 48.707664], [9.262623, 48.707736], [9.262581, 48.70788], [9.262787, 48.707868], [9.262925, 48.707858], [9.263107, 48.707867], [9.263177, 48.707884], [9.263232, 48.707911], [9.263269, 48.707937], [9.263308, 48.707984], [9.263401, 48.708148], [9.263432, 48.708219], [9.263483, 48.708359], [9.26354, 48.708538], [9.263549, 48.708567], [9.26356, 48.708596], [9.263599, 48.708721], [9.263638, 48.708872], [9.263643, 48.708888], [9.263675, 48.70898], [9.263698, 48.709042], [9.263709, 48.709063], [9.263769, 48.709142], [9.263841, 48.709219], [9.263905, 48.709275], [9.264084, 48.709392], [9.264271, 48.709459], [9.264316, 48.70947], [9.264344, 48.709474], [9.264489, 48.709468], [9.26462, 48.709439], [9.264783, 48.7094], [9.264846, 48.709382], [9.265067, 48.709319], [9.265255, 48.709274], [9.265615, 48.709208], [9.265732, 48.709194], [9.26598, 48.709174], [9.266224, 48.709159], [9.266507, 48.709141], [9.266901, 48.709111], [9.267183, 48.70907], [9.267263, 48.709058], [9.26746, 48.709014], [9.267781, 48.708919], [9.267879, 48.708887], [9.267944, 48.708861], [9.268076, 48.708802], [9.268203, 48.708746], [9.26847, 48.708623], [9.268836, 48.708487], [9.269142, 48.708412], [9.269508, 48.708344], [9.269731, 48.708321], [9.270208, 48.708308], [9.27053, 48.708324], [9.270839, 48.708364], [9.271104, 48.708425], [9.271186, 48.708454], [9.271297, 48.708497], [9.271404, 48.708556], [9.271483, 48.70861], [9.271602, 48.708729], [9.271654, 48.708815], [9.271695, 48.708902], [9.271726, 48.708999], [9.27174, 48.709261], [9.271739, 48.709356], [9.271736, 48.709445], [9.271735, 48.709602], [9.271737, 48.709731], [9.271743, 48.709801], [9.271769, 48.709989], [9.271862, 48.710238], [9.272021, 48.710516], [9.272154, 48.710679], [9.272244, 48.710778], [9.272355, 48.710882], [9.272492, 48.711004], [9.272695, 48.71118], [9.272883, 48.711347], [9.273035, 48.711481], [9.273196, 48.711627], [9.273442, 48.711862], [9.273565, 48.711985], [9.273686, 48.712108], [9.273884, 48.71232], [9.274076, 48.712529], [9.274386, 48.712878], [9.274568, 48.713079], [9.274732, 48.71326], [9.274826, 48.713357], [9.275127, 48.713621], [9.27517, 48.713669], [9.275202, 48.713719], [9.275266, 48.713897], [9.275281, 48.713989], [9.275098, 48.714001], [9.274885, 48.714028], [9.274678, 48.714071], [9.274412, 48.714136], [9.274191, 48.714199], [9.273987, 48.714264], [9.273682, 48.714388], [9.273578, 48.714433], [9.27352, 48.714463], [9.273422, 48.714546], [9.273074, 48.714789], [9.272987, 48.714868], [9.272905, 48.714942], [9.272727, 48.715156], [9.272604, 48.71534], [9.272561, 48.715436], [9.272502, 48.715557], [9.272464, 48.715618], [9.272404, 48.715669], [9.272339, 48.715874], [9.272288, 48.716092], [9.272278, 48.716139], [9.272269, 48.716197], [9.272223, 48.716553], [9.272173, 48.716895], [9.272159, 48.717033], [9.272125, 48.717291], [9.272078, 48.717655], [9.272064, 48.717745], [9.271996, 48.718285], [9.271988, 48.718358], [9.271973, 48.718459], [9.271934, 48.718752], [9.271886, 48.719127], [9.271863, 48.719296], [9.271797, 48.71981], [9.271784, 48.719891], [9.271776, 48.719944], [9.271764, 48.720006], [9.271684, 48.72061], [9.271681, 48.720651], [9.271679, 48.720685], [9.271674, 48.720723], [9.271667, 48.7208], [9.271645, 48.720978], [9.271611, 48.721349], [9.271607, 48.721435], [9.271657, 48.721442], [9.271702, 48.72146], [9.271755, 48.721517], [9.271758, 48.721551], [9.271749, 48.721576], [9.271706, 48.721618], [9.271637, 48.721642], [9.271599, 48.721645], [9.2716, 48.72169], [9.271634, 48.721764], [9.271798, 48.721955], [9.271837, 48.722001], [9.271873, 48.722046], [9.272034, 48.722377], [9.272077, 48.722464], [9.272086, 48.722489], [9.272411, 48.72321], [9.272447, 48.723285], [9.271695, 48.723433], [9.271455, 48.723481], [9.271447, 48.723464]],
        "type": "LineString"
      }
    }],
    "bbox": [8.436021, 48.692806, 9.275281, 49.420538],
    /*"metadata": {
      "attribution": "openrouteservice.org | OpenStreetMap contributors",
      "service": "routing",
      "timestamp": 1681987630699,
      "query": {
        "coordinates": [[8.681495, 49.41461], [9.271429058134341, 48.72346813153545]],
        "profile": "driving-car",
        "format": "json"
      },
      "engine": {"version": "6.8.1", "build_date": "2023-03-05T05:01:48Z", "graph_date": "2023-04-02T15:44:32Z"}
    }*/
  }

  constructor(public router: Router, private userDataService: UserDataService, private resolver: ComponentFactoryResolver, private injector: Injector) {
  }

  ngOnInit() {
    //Subscribe to current user location
    this.userDataService.getCurrentLocation().subscribe((value) => {
      this.currentUserLocation = value;
      console.log('CHANGED: ', value);
      //When map is loaded, set view to current lat/long and set zoom value
      if (this.map) {
        this.map.setView([this.currentUserLocation.latitude, this.currentUserLocation.longitude], 17);
        L.marker([this.currentUserLocation.latitude, this.currentUserLocation.longitude], {icon: this.homeIcon}).addTo(this.map);
      }
    })
    console.log('LOAD!')
    this.loadMap();
  }

  // When Location in search bar is selected
  ngOnChanges(changes: any) {
    if (this.selectedLocation !== null) {
      console.log('CHANGE: ', this.selectedLocation.geometry.coordinates[0]);
      /*L.marker([this.selectedLocation.geometry.coordinates[1], this.selectedLocation.geometry.coordinates[0]], {icon: this.greenIcon}).addTo(this.map!);*/
      this.map!.setView([this.selectedLocation.geometry.coordinates[1], this.selectedLocation.geometry.coordinates[0]], 15);
    }
    this.createMarker();
  }

  loadMap() {
   this.map = L.map('mapId').setView([this.currentUserLocation.latitude, this.currentUserLocation.longitude], 10);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',).addTo(this.map);
    this.map.invalidateSize();
    window.dispatchEvent(new Event('resize'));  //prevent loading bug in ionic

    this.createMarker();

    //center marker when popup opens
    this.map.on('popupopen', (e: any) => {
      var px = this.map!.project(e.target._popup._latlng); // find the pixel location on the map where the popup anchor is
      px.y -= e.target._popup._container.clientHeight / 2; // find the height of the popup container, divide by 2, subtract from the Y axis of marker location
      this.map!.panTo(this.map!.unproject(px), {animate: true}); // pan to new center
    });

    L.geoJSON(this.json).addTo(this.map);
  }

  createMarker() {
    for (let marker of this.evcs) {
      console.log('CREATE MARKER: ', marker);
      L.marker([marker.latitude, marker.longitude], {icon: this.evcsIcon}).addTo(this.map).bindPopup(this.component.location.nativeElement, {className: 'test'}).on('click', (event) => this.setPopupConfig(event));
    }
  }

  setPopupConfig(event: any) {
    console.log('HUHU', event.target._latlng);
    this.component.instance.name = 'Hans Martin Müller';
    this.component.instance.latitude = event.target._latlng.lat;
    this.component.instance.longitude = event.target._latlng.lng;
    this.component.changeDetectorRef.detectChanges();
  }

  byString(o: any, s: any) {
    s = s.replace(/\[(\w+)\]/g, '.$1'); // convert indexes to properties
    s = s.replace(/^\./, '');           // strip a leading dot
    var a = s.split('.');
    for (var i = 0, n = a.length; i < n; ++i) {
      var k = a[i];
      if (k in o) {
        o = o[k];
      } else {
        return;
      }
    }
    return o;
  }

}
